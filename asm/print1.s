;----------------------------------------------------------------------
;			cc65 includes
;----------------------------------------------------------------------
.include "telestrat.inc"

;----------------------------------------------------------------------
;			Orix Kernel includes
;----------------------------------------------------------------------
.include "kernel/src/include/kernel.inc"

;----------------------------------------------------------------------
;			Orix Shell includes
;----------------------------------------------------------------------

;----------------------------------------------------------------------
;			Orix SDK includes
;----------------------------------------------------------------------

;----------------------------------------------------------------------
;				Imports
;----------------------------------------------------------------------
; From sopt
.import tincr
.importzp tepo

;----------------------------------------------------------------------
;				Exports
;----------------------------------------------------------------------
.export print1, outanl1

;----------------------------------------------------------------------
;				Page Zéro
;----------------------------------------------------------------------

;----------------------------------------------------------------------
; Defines / Constants
;----------------------------------------------------------------------

;----------------------------------------------------------------------
; Variables et buffers
;----------------------------------------------------------------------

;----------------------------------------------------------------------
;				Programme
;----------------------------------------------------------------------
.feature labels_without_colons
.segment "CODE"
.reloc

;----------------------------------------------------------------------
;               print string
;
; Entrée:
;
; Sortie:
;
; Variables:
;	Modifiées:
;		-
;	Utilisées:
;		-
; Sous-routines:
;	-
;----------------------------------------------------------------------
print1  pha                     ;string behind JSR instr. until 00
        txa                     ;save mem. and X
        pha
        lda     tepo
        pha
        lda     tepo+1
        pha
        tsx
        lda     $105,x          ;get return address
        sta     tepo
        lda     $106,x
        sta     tepo+1
pria    jsr     tincr
        beq     prib
        jsr     outanl          ;auto lf
        bcc     pria
prib    tsx                     ;setup new return address
        lda     tepo
        sta     $105,x
        lda     tepo+1
        sta     $106,x
        pla                     ;get mem and X back
        sta     tepo+1
        pla
        sta     tepo
        pla
        tax
        pla
        rts

;----------------------------------------------------------------------
;
;----------------------------------------------------------------------
outanl1
	pha
	cmp #$0d
	bne suite
	BRK_KERNEL XCRLF
	pla
	rts

  suite:
 	BRK_KERNEL XWR0
 	pla
 	rts

outanl := outanl1

